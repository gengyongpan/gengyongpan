<%@ page language="java" contentType="text/html; charset=utf-8"
	pageEncoding="UTF-8"%>
<%
	String contextPath = request.getContextPath();
	String chartID = request.getParameter('chartID');
	String dataURL = request.getParameter('dataURL');
%>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>丝绸之路</title>
    <link rel="stylesheet" href="css/global.css">
    <link href="css/global_1.css" rel="stylesheet">
    <link href="css/global.css" rel="stylesheet">
    <link href="css/global_2.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #gjaq_yuce_1 {
            height: 900px;
            margin-left:20px;
            width: 1250px;
            background-image: url(images/silkroad_map.png);
			background-size:100% 100%;
        }

        #gjaq_yuce {
            float: left;
            height: 100%;
            width: 100%;
            transform: rotateX(50deg)
        }

        .clear {
            clear: both;
        }

        .zczl_1 {
            width: 430px;
            height: 130px;
            top: 50px;
            left: 30px;
            color: rgb(141, 214, 238);
            font-size: 14px;
        }

        .zczl_2 {
            width: 430px;
            height: 130px;
            top: -80px;
            left: 514px;
            color: rgb(141, 214, 238);
            font-size: 14px;
        }
       .theme_2 #gjaq_yuce_1{
       	  	background-image: url(images/silkroad_map_red.png);
        	color:#5c0000;
       }
    </style>
</head>

<body class="theme_1">
<div id="gjaq_yuce_1">
    <div id="gjaq_yuce">
    </div>
    <div class="zczl_1" style="width: 430px;  height: 130px; position: relative;">
            <div class="title3">
                <div class="title3Ball"></div>
                <div class="title3Left">丝绸之路经济带</div>
                <div class="title3Slash"></div>
                <div class="title3Center"></div>
                <div class="title3Right"></div>
            </div>
            <div class="chartBorder2" style="width: 100%; height: 100%;">
                <span style="position: absolute;top: 46px;left: 50px;">重点关注贸易国</span>
		        <span style="position: absolute;top: 66px;left: 50px">平均贸易增加量<b
		                style="font-size: 28px;color:yellow;">100%</b></span>
		        <span style="position: absolute;top: 66px;left: 240px">税收增加量<b
		                style="font-size: 28px;color:yellow;color: rgb(141, 214, 238);">100%</b></span>
                <div id="test" style="width: 100%; height: 100%;">
                </div>
            </div>
    </div>
      
    <div class="zczl_2" style="width: 430px;  height: 130px; position: relative;">
            <div class="title3">
                <div class="title3Ball"></div>
                <div class="title3Left">海上丝绸经济带</div>
                <div class="title3Slash"></div>
                <div class="title3Center"></div>
                <div class="title3Right"></div>
            </div>
            <div class="chartBorder2" style="width: 100%; height: 100%;">
                <span style="position: absolute;top: 46px;left: 50px;">重点关注贸易国</span>
		        <span style="position: absolute;top: 66px;left: 50px">平均贸易增加量<b
		                style="font-size: 28px;color:yellow;">100%</b></span>
		        <span style="position: absolute;top: 66px;left: 240px">税收增加量<b
		                style="font-size: 28px;color:yellow;color: rgb(141, 214, 238);">100%</b></span>
                <div id="test" style="width: 100%; height: 100%;">
                </div>
            </div>
    </div>
</div>
<script src="js/jquery-1.9.1.min.js"></script>
<script src="js/echarts-all.js"></script>
<script src="js/theme_custom.js"></script>
<script>
// 主题更换--框
changeEchartsColor();
function changeBodyColor(){
	if(theme_opt == 'red'){
		$("body").addClass("theme_2").removeClass("theme_1");
	}else if(theme_opt == 'blue'){
		$("body").addClass("theme_1").removeClass("theme_2");
	}else{
		$("body").removeClass("theme_2").removeClass("theme_1");
	}	
};
changeBodyColor();
////////
    $(function () {
        // 基于准备好的dom，初始化echarts图表
        //var point = new BMap.Point(startPoint.x, startPoint.y);
        var option = {
            series: [
                //中国及通用参数 系列索引(SeriesIndex)值为0
                {
                    name: '世界地图',
                    type: 'map',
                    mapType: 'world',
                    z: 10,
                    roam: false,
                    selectedMode: 'null',
                    mapLocation: {width: '2700', height: '1944', x: '-1200', y: '30'},
                    itemStyle: {
                        normal: {
                            label: {show: false},
                            color: 'rgba(0,0,0, 0)',
                            borderColor: 'rgb(4,70,122)',
                            borderWidth: 0
                        },
                        emphasis: {
                            label: {show: false},
                            color: 'rgba(0,0,0, 0)'
                        }
                    },
                    //自定义名称
                    nameMap: {
                        'Afghanistan': '阿富汗',
                        'Angola': '安哥拉',
                        'Albania': '阿尔巴尼亚',
                        'United Arab Emirates': '阿联酋',
                        'Argentina': '阿根廷',
                        'Armenia': '亚美尼亚',
                        'French Southern and Antarctic Lands': '法属南半球和南极领地',
                        'Australia': '澳大利亚',
                        'Austria': '奥地利',
                        'Azerbaijan': '阿塞拜疆',
                        'Burundi': '布隆迪',
                        'Belgium': '比利时',
                        'Benin': '贝宁',
                        'Burkina Faso': '布基纳法索',
                        'Bangladesh': '孟加拉国',
                        'Bulgaria': '保加利亚',
                        'The Bahamas': '巴哈马',
                        'Bosnia and Herzegovina': '波斯尼亚和黑塞哥维那',
                        'Belarus': '白俄罗斯',
                        'Belize': '伯利兹',
                        'Bermuda': '百慕大',
                        'Bolivia': '玻利维亚',
                        'Brazil': '巴西',
                        'Brunei': '文莱',
                        'Bhutan': '不丹',
                        'Botswana': '博茨瓦纳',
                        'Central African Republic': '中非共和国',
                        'Canada': '加拿大',
                        'Switzerland': '瑞士',
                        'Chile': '智利',
                        'China': '中国',
                        'Ivory Coast': '象牙海岸',
                        'Cameroon': '喀麦隆',
                        'Democratic Republic of the Congo': '刚果民主共和国',
                        'Republic of the Congo': '刚果共和国',
                        'Colombia': '哥伦比亚',
                        'Costa Rica': '哥斯达黎加',
                        'Cuba': '古巴',
                        'Northern Cyprus': '北塞浦路斯',
                        'Cyprus': '塞浦路斯',
                        'Czech Republic': '捷克共和国',
                        'Germany': '德国',
                        'Djibouti': '吉布提',
                        'Denmark': '丹麦',
                        'Dominican Republic': '多明尼加共和国',
                        'Algeria': '阿尔及利亚',
                        'Ecuador': '厄瓜多尔',
                        'Egypt': '埃及',
                        'Eritrea': '厄立特里亚',
                        'Spain': '西班牙',
                        'Estonia': '爱沙尼亚',
                        'Ethiopia': '埃塞俄比亚',
                        'Finland': '芬兰',
                        'Fiji': '斐',
                        'Falkland Islands': '福克兰群岛',
                        'France': '法国',
                        'Gabon': '加蓬',
                        'United Kingdom': '英国',
                        'Georgia': '格鲁吉亚',
                        'Ghana': '加纳',
                        'Guinea': '几内亚',
                        'Gambia': '冈比亚',
                        'Guinea Bissau': '几内亚比绍',
                        'Equatorial Guinea': '赤道几内亚',
                        'Greece': '希腊',
                        'Greenland': '格陵兰',
                        'Guatemala': '危地马拉',
                        'French Guiana': '法属圭亚那',
                        'Guyana': '圭亚那',
                        'Honduras': '洪都拉斯',
                        'Croatia': '克罗地亚',
                        'Haiti': '海地',
                        'Hungary': '匈牙利',
                        'Indonesia': '印尼',
                        'India': '印度',
                        'Ireland': '爱尔兰',
                        'Iran': '伊朗',
                        'Iraq': '伊拉克',
                        'Iceland': '冰岛',
                        'Israel': '以色列',
                        'Italy': '意大利',
                        'Jamaica': '牙买加',
                        'Jordan': '约旦',
                        'Japan': '日本',
                        'Kazakhstan': '哈萨克斯坦',
                        'Kenya': '肯尼亚',
                        'Kyrgyzstan': '吉尔吉斯斯坦',
                        'Cambodia': '柬埔寨',
                        'South Korea': '韩国',
                        'Kosovo': '科索沃',
                        'Kuwait': '科威特',
                        'Laos': '老挝',
                        'Lebanon': '黎巴嫩',
                        'Liberia': '利比里亚',
                        'Libya': '利比亚',
                        'Sri Lanka': '斯里兰卡',
                        'Lesotho': '莱索托',
                        'Lithuania': '立陶宛',
                        'Luxembourg': '卢森堡',
                        'Latvia': '拉脱维亚',
                        'Morocco': '摩洛哥',
                        'Moldova': '摩尔多瓦',
                        'Madagascar': '马达加斯加',
                        'Mexico': '墨西哥',
                        'Macedonia': '马其顿',
                        'Mali': '马里',
                        'Myanmar': '缅甸',
                        'Montenegro': '黑山',
                        'Mongolia': '蒙古',
                        'Mozambique': '莫桑比克',
                        'Mauritania': '毛里塔尼亚',
                        'Malawi': '马拉维',
                        'Malaysia': '马来西亚',
                        'Namibia': '纳米比亚',
                        'New Caledonia': '新喀里多尼亚',
                        'Niger': '尼日尔',
                        'Nigeria': '尼日利亚',
                        'Nicaragua': '尼加拉瓜',
                        'Netherlands': '荷兰',
                        'Norway': '挪威',
                        'Nepal': '尼泊尔',
                        'New Zealand': '新西兰',
                        'Oman': '阿曼',
                        'Pakistan': '巴基斯坦',
                        'Panama': '巴拿马',
                        'Peru': '秘鲁',
                        'Philippines': '菲律宾',
                        'Papua New Guinea': '巴布亚新几内亚',
                        'Poland': '波兰',
                        'Puerto Rico': '波多黎各',
                        'North Korea': '北朝鲜',
                        'Portugal': '葡萄牙',
                        'Paraguay': '巴拉圭',
                        'Qatar': '卡塔尔',
                        'Romania': '罗马尼亚',
                        'Russia': '俄罗斯',
                        'Rwanda': '卢旺达',
                        'Western Sahara': '西撒哈拉',
                        'Saudi Arabia': '沙特阿拉伯',
                        'Sudan': '苏丹',
                        'South Sudan': '南苏丹',
                        'Senegal': '塞内加尔',
                        'Solomon Islands': '所罗门群岛',
                        'Sierra Leone': '塞拉利昂',
                        'El Salvador': '萨尔瓦多',
                        'Somaliland': '索马里兰',
                        'Somalia': '索马里',
                        'Republic of Serbia': '塞尔维亚共和国',
                        'Suriname': '苏里南',
                        'Slovakia': '斯洛伐克',
                        'Slovenia': '斯洛文尼亚',
                        'Sweden': '瑞典',
                        'Swaziland': '斯威士兰',
                        'Syria': '叙利亚',
                        'Chad': '乍得',
                        'Togo': '多哥',
                        'Thailand': '泰国',
                        'Tajikistan': '塔吉克斯坦',
                        'Turkmenistan': '土库曼斯坦',
                        'East Timor': '东帝汶',
                        'Trinidad and Tobago': '特里尼达和多巴哥',
                        'Tunisia': '突尼斯',
                        'Turkey': '土耳其',
                        'United Republic of Tanzania': '坦桑尼亚联合共和国',
                        'Uganda': '乌干达',
                        'Ukraine': '乌克兰',
                        'Uruguay': '乌拉圭',
                        'United States of America': '美国',
                        'Uzbekistan': '乌兹别克斯坦',
                        'Venezuela': '委内瑞拉',
                        'Vietnam': '越南',
                        'Vanuatu': '瓦努阿图',
                        'West Bank': '西岸',
                        'Yemen': '也门',
                        'South Africa': '南非',
                        'Zambia': '赞比亚',
                        'Zimbabwe': '津巴布韦'
                    },
                    //各国首都绝对经纬度
                    geoCoord: {
                        '中国': [116.4551, 37.2539],
                        '马来西亚': [121.4, 8.2539],
                        '印度': [80.4, 20.2539],
                        '伊朗': [53.6880, 32.4279],
                        '哈萨克斯坦': [68.6880, 44.4279],
                        '俄罗斯': [57.668, 54.366],
                        '土耳其': [28.58, 38.026],
                        '波兰': [1, 46.026],
                        '肯尼亚': [36.81251999999995, 7.27529]
                    },
//                  data: [],
                    markPoint: {
                        clickable: false,
                        itemStyle: {
                            normal: {
                                label: {show: false}
                            },
                            emphasis: {
                                label: {show: false}
                            }
                        },
                        symbol: 'images/country/zhongguo.png',
                        symbolSize: [80, 150],
                        effect: {
                            show: false,
                            shadowBlur: 0
                        },
//                      data: [
//                          {name: '中国'}
//                      ]
                    }
                },
                //陆路-红线与红圈 系列索引(SeriesIndex)值为1，即sIndex = 1
                {
                    name: '世界地图',
                    type: 'map',
                    mapType: 'world',
                    z: 5,
                    data: [],
                    markPoint: {
                        symbol: 'emptyCircle',
                        symbolSize: 30,
                        effect: {
                            show: true,
                            period: 10,
                            shadowBlur: 0
                        },
                        itemStyle: {
                            normal: {
                                label: {show: false}
                            },
                            emphasis: {
                                label: {show: false}
                            }
                        },
//                      data: []
                    },
                    markLine: {
                        clickable: false,
                        smooth: true,
                        effect: {
                            show: true,
                            scaleSize: 1,
                            period: 15,
                            loop: false,
                            color: '#fff',
                            shadowBlur: 10
                        },
                        itemStyle: {
                            normal: {
                                borderWidth: 2,
                                lineStyle: {
                                    type: 'solid',
                                    shadowBlur: 1
                                },
                                label: {show: false},
                                color: 'red'
                            },
                            emphasis: {
                                label: {show: false}
                            }
                        },
                        data: [
                            /*[{name: '中国'}, {name: '俄罗斯'}],
                             [{name: '俄罗斯'}, {name: '土耳其'}],
                             [{name: '土耳其'}, {name: '印度'}],
                             [{name: '印度'}, {name: '马来西亚'}],
                             [{name: '马来西亚'}, {name: '中国'}]*/
                        ]
                    }
                },
                //海路-白线与白圈 系列索引(SeriesIndex)值为2，即 sIndex = 2
                {
                    name: '世界地图',
                    type: 'map',
                    mapType: 'world',
                    data: [],
                    z: 5,
                    markPoint: {
                        symbol: 'emptyCircle',
                        symbolSize: 30,
                        effect: {
                            show: true,
                            period: 10,
                            shadowBlur: 0
                        },
                        itemStyle: {
                            normal: {
                                label: {show: false},
                                color: '#fff'
                            },
                            emphasis: {
                                label: {show: false}
                            }
                        },
//                      data: []
                    },
                    markLine: {
                        smooth: true,
                        //symbol: ['none', 'circle'],
                        symbolSize: 1,
                        effect: {
                            show: true,
                            scaleSize: 0.5,
                            period: 15,
                            loop: false,
                            color: '#f00',
                            shadowBlur: 10
                        },
                        itemStyle: {
                            normal: {
                                label: {show: false},
                                color: '#fff',
                                borderWidth: 4
                                //borderColor:'rgba(30,144,255,0.5)'
                            },
                            emphasis: {
                                label: {
                                    show: false
                                }
                            }
                        },
                        data: [
                            /*[{name: '中国'}, {name: '肯尼亚'}],
                             [{name: '肯尼亚'}, {name: '印度'}],
                             [{name: '印度'}, {name: '马来西亚'}]*/

                        ]
                    }
                },
                //国家方框与显示值 系列索引(SeriesIndex)值为3，即 sIndex = 3
                {
                    name: '世界地图',
                    type: 'map',
                    mapType: 'world',
                    data: [],
                    z: 10,
                    markPoint: {
                        symbolSize: [80, 145],
                        effect: {
                            show: false,
                            shadowBlur: 0
                        },
                        itemStyle: {
                            normal: {
                                color: function (para) {
                                    return (parseFloat(para.data.value) > 0 ? 'rgb(255,0,0)' : 'rgb(0,255,0)');
                                },
                                label: {
                                    show: true,
                                    formatter: '{c}' + '%\n\n\n\n\n\n\n\n\n',
                                    textStyle: {
                                        color: 'auto',
                                        fontSize: 20,
                                        align: 'right',
                                        fontWeight: 'bold'
                                    }
                                }
                            },
                            emphasis: {
                                label: {
                                    show: false
                                }
                            }
                        },
                        data: [
                            /*                            {name: '马来西亚', value: '-' + 4.9, symbol: 'images/malaixiya.png', dataType: 'lane'},
                             {name: '印度', value: '+' + 6.8, symbol: 'images/yindu.png', dataType: 'lane'},
                             {name: '肯尼亚', value: '+' + 2.0, symbol: 'images/kenniya.png', dataType: 'land'},
                             {name: '伊朗', value: '+' + 30.3, symbol: 'images/yilang.png', dataType: 'land'},
                             {name: '俄罗斯', value: '+' + 5.6, symbol: 'images/eluosi.png', dataType: 'land'},
                             {name: '土耳其', value: '+' + 2.4, symbol: 'images/tuerqi.png', dataType: 'land'},
                             {name: '波兰', value: '+' + 14.9, symbol: 'images/bolan.png', dataType: 'land'},
                             {name: '哈萨克斯坦', value: '-' + 22.4, symbol: 'images/hasakesitan.png', dataType: 'land'}*/
                        ]
                    }
                }
            ]
        };
        // 为echarts对象加载数据
        var contextPath = "<%=contextPath%>";
		var dataURL = "<%=dataURL%>":
		var echarts_<%=chartID%> = echarts.init(document.getElementById("gjaq_yuce"));
		(function(){
			var datas = {
				chartMoudleId: "",
				sqlParams: {}
			};
			$.ajax({
	            type: "POST",
	            url: getChartDataURL(dataURL, contextPath) + '?chartMoudleId=',
	            dataType: "json",
	            data: datas,
	            success: function (msg) {
	            	var option_data = eval('(' + msg.data[0].option + ')');
	            	var strOptionCode = sessionStorage.getItem("echarts_option_<%=chartID%>");
	            	(new Function(strOptionCode))();
	            	option_data = copyJSONAtoB_noArrayNull(option, option_data);
	            	echarts_<%=chartID%>.setOption(option_data);
	            	echarts_<%=chartID%>.setTheme(changeEchartsColor());
	            },
	            error: function (xhr, txt, err) {
	                console.log(xhr.status + ":" + txt + ", " + err.message);
	            }
			});
		})();
       //更改图片主题 （国家）
       changeEchartsColor();
           function changeCountysImg(){
        		if(theme_opt == 'red'){
					return 'images/country_red';
				}else if(theme_opt == 'blue'){
					return 'images/country_blue';
				}else{
					return 'images/country';
				}	
        }
        changeCountysImg();
        var markPoint_data = [
            {name: '马来西亚', value: '-' + 4.9, symbol:changeCountysImg()+'/malaixiya.png', dataType: 'lane'},
            {name: '印度', value: '+' + 6.8, symbol: changeCountysImg()+'/yindu.png', dataType: 'lane'},
            {name: '肯尼亚', value: '+' + 2.0, symbol: changeCountysImg()+'/kenniya.png', dataType: 'lane'},
            {name: '哈萨克斯坦', value: '-' + 22.4, symbol: changeCountysImg()+'/hasakesitan.png', dataType: 'land'},
            {name: '伊朗', value: '+' + 30.3, symbol: changeCountysImg()+'/yilang.png', dataType: 'land'},
            {name: '土耳其', value: '+' + 2.4, symbol: changeCountysImg()+'/tuerqi.png', dataType: 'land'},
            {name: '俄罗斯', value: '+' + 5.6, symbol: changeCountysImg()+'/eluosi.png', dataType: 'land'},
            {name: '波兰', value: '+' + 14.9, symbol: changeCountysImg()+'/bolan.png', dataType: 'land'}
        ];
        //land为陆路，lane为海路
        var markPoint_data_land = [], markPoint_data_lane = [];
        for (var i = 0; i < markPoint_data.length; i++) {
            markPoint_data[i].dataType == 'land' && (markPoint_data_land.push(markPoint_data[i]));
            markPoint_data[i].dataType == 'lane' && (markPoint_data_lane.push(markPoint_data[i]));
        }
        //sIndex（(SeriesIndex)）代表所属系列索引值，markPoint1代表圆圈，markPoint2代表方框，markLine代表连线
        var sIndex_markPoint1_land = 1, sIndex_markPoint2_land = 3, sIndex_markLine_land = 1;
        var sIndex_markPoint1_lane = 2, sIndex_markPoint2_lane = 3, sIndex_markLine_lane = 2;
        var markPoint_data_i = 0;
        //显示国家方框与值的函数，参数依次为：ECharts对象，方框所在系列索引，数据集，总共的计数
        var setMarkPointData1 = function (ecObj, sIndex, data, total_i) {
            var current_i = total_i % data.length;
            var pre_i = (current_i - 1 + data.length) % data.length;
            var next_i = (current_i + 1) % data.length;
            var markData = ecObj.getSeries()[sIndex].markPoint;
            markData.data = [{
                name: data[current_i].name,
                value: data[current_i].value
            }];
            myChart1.delMarkPoint(sIndex, data[pre_i].name);
            myChart1.addMarkPoint(sIndex, markData);
        };
        //显示圆圈的函数
        var setMarkPointData2 = function (ecObj, sIndex, data, total_i) {
            var current_i = total_i % data.length;
            var pre_i = (current_i - 1 + data.length) % data.length;
            var next_i = (current_i + 1) % data.length;
            var markData = ecObj.getSeries()[sIndex].markPoint;
            markData.data = [data[current_i]];
            if (current_i == 0) {
                for (var j = 0; j < data.length; j++) {
                    var markName = data[j].name;
                    ecObj.delMarkPoint(sIndex, markName);
                }
            }
            ecObj.addMarkPoint(sIndex, markData);
        };
        //显示连线的函数
        var setMarkLineData = function (ecObj, sIndex, data, total_i) {
            var current_i = total_i % data.length;
            var pre_i = (current_i - 1 + data.length) % data.length;
            var next_i = (current_i + 1) % data.length;
            var markData = ecObj.getSeries()[sIndex].markLine;
            markData.data = [];
            var startPoint = data[pre_i];
            if (current_i == 0) {
                startPoint = {name: '中国'};
                for (var j = 0; j < data.length; j++) {
                    var next_j = (j + 1) % data.length;
                    var startPoint_j = (j == data.length - 1) ? {name: '中国'} : data[j];
                    var markName = startPoint_j.name + " > " + data[next_j].name;
                    ecObj.delMarkLine(sIndex, markName);
                }
            }
            markData.data.push([startPoint, data[current_i]]);
            ecObj.addMarkLine(sIndex, markData);
        };

        setInterval(function () {
        	var half_i = Math.floor(markPoint_data_i / 2);
        	if(markPoint_data_i % 2){
		        setMarkLineData(myChart1, sIndex_markLine_lane, markPoint_data_lane, half_i);
		        setMarkPointData1(myChart1, sIndex_markPoint1_lane, markPoint_data_lane, half_i);
		        setMarkPointData2(myChart1, sIndex_markPoint2_lane, markPoint_data_lane, half_i);
          	} else {
            	setMarkLineData(myChart1, sIndex_markLine_land, markPoint_data_land, half_i);
            	setMarkPointData1(myChart1, sIndex_markPoint1_land, markPoint_data_land, half_i);
            	setMarkPointData2(myChart1, sIndex_markPoint2_land, markPoint_data_land, half_i);
          	}
        	markPoint_data_i++;
        }, 5000);
        
    });
</script>
</body>
</html>